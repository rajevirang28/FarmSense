<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expert Soil Analysis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-8">
      <h1 class="mb-2 text-center text-success">Expert Soil Analysis</h1>
      <p class="lead text-center mb-5 text-muted">Enter the detailed soil parameters below to receive specialized crop suggestion.</p>

      <form action="/expert.html" method="POST" class="row g-4 border p-4 rounded shadow-sm">
        
        <div class="col-12">
          <label for="city" class="form-label fw-bold">Select City (Maharashtra)</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
            <select id="city" name="city" class="form-select" required>
              <option value="">-- Select a City --</option>
              <option value="Mumbai">Mumbai</option>
              <option value="Pune">Pune</option>
              <option value="Nagpur">Nagpur</option>
              <option value="Nashik">Nashik</option>
              <option value="Aurangabad">Aurangabad</option>
              <option value="Solapur">Solapur</option>
              <option value="Kolhapur">Kolhapur</option>
              <option value="Amravati">Amravati</option>
              <option value="Latur">Latur</option>
              <option value="Akola">Akola</option>
              <option value="Chandrapur">Chandrapur</option>
              <option value="Sangli">Sangli</option>
              <option value="Ahmednagar">Ahmednagar</option>
              <option value="Thane">Thane</option>
              <option value="Satara">Satara</option>
            </select>
          </div>
        </div>
        
        
        <div class="col-12 mt-3">
          <h5 class="text-primary">
            Environmental Parameters 
            <button class="btn btn-sm btn-outline-primary ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#environmentalData" aria-expanded="false" aria-controls="environmentalData">
              <i class="fas fa-eye"></i> Show Details
            </button>
          </h5>
        </div>
        
        <div class="collapse row g-4" id="environmentalData">
          <div class="col-12 col-md-6">
            <label class="form-label fw-bold">NDVI Value</label>
            <input type="text" id="ndvi" name="ndvi" class="form-control" placeholder="Auto" readonly />
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label fw-bold">Average Temperature (¬∞C)</label>
            <input type="text" id="avgTemp" name="avgTemp" class="form-control" readonly />
          </div>
          
          <div class="col-12 col-md-6">
            <label class="form-label fw-bold">Rainfall (mm)</label>
            <input type="text" id="rainfall" name="rainfall" class="form-control" readonly />
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label fw-bold">Wind Speed (m/s)</label>
            <input type="text" id="windSpeed" name="windSpeed" class="form-control" readonly />
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label fw-bold">Cloud Cover (%)</label>
            <input type="text" id="cloudCover" name="cloudCover" class="form-control" readonly />
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label fw-bold">Sunshine Hours (hours/day)</label>
            <input type="text" id="sunshine" name="sunshine" class="form-control" readonly />
          </div>
          
          <div class="col-12 col-md-6">
            <label class="form-label fw-bold">Organic Carbon (%)</label>
            <input type="number" step="0.01" id="organicCarbon" name="organicCarbon" class="form-control" placeholder="e.g., 0.75" />
          </div>
        </div>


        <div class="col-12">
          <h5 class="mt-3 mb-3 text-primary">Soil Parameters (Required)</h5>
        </div>
        
        <div class="col-12 col-md-6">
          <label for="ph" class="form-label">Soil pH Value (0.0 to 14.0)</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-flask"></i></span>
            <input type="number" step="0.1" id="ph" name="ph" class="form-control" 
                   placeholder="e.g., 6.5" 
                   min="0" max="14" 
                   required />
          </div>
          <div class="form-text">Neutral pH is around 7.0.</div>
        </div>
        
        <div class="col-12 col-md-6">
          <label for="nitrogen" class="form-label">Nitrogen Level (mg/kg)</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-leaf"></i></span>
            <input type="number" id="nitrogen" name="nitrogen" class="form-control" 
                   placeholder="e.g., 85" 
                   
                   required />
          </div>
          <div class="form-text">Essential macronutrient level.</div>
        </div>

        <div class="col-12 col-md-6">
          <label for="phosphorus" class="form-label">Phosphorus (kg/ha)</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-bolt"></i></span>
            <input type="number" step="0.1" id="phosphorus" name="phosphorus" class="form-control" 
                   placeholder="e.g., 25.0" 
                   min="10.4"  /> 
          </div>
          <div class="form-text">Range is constrained from 10.4 to 42.6 kg/ha.</div>
        </div>
        
        <div class="col-12 col-md-6">
          <label for="potassium" class="form-label">Potassium (mg/kg)</label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-bolt"></i></span>
            <input type="number" id="potassium" name="potassium" class="form-control" 
                   placeholder="e.g., 220" 
                   min="0" />
          </div>
        </div>

        
        <div class="col-12 col-md-6">
          <label for="soilTemperature" class="form-label">Soil Temperature (¬∞C) <span class="text-muted">(Optional)</span></label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-thermometer-half"></i></span>
            <input type="number" step="0.1" id="soilTemperature" name="soilTemperature" class="form-control" 
                   placeholder="e.g., 25.5" 
                   min="0" />
          </div>
        </div>

        <div class="col-12 col-md-6">
          <label for="nutrientImbalance" class="form-label">Nutrient Imbalance Value <span class="text-muted">(Optional)</span></label>
          <div class="input-group">
            <span class="input-group-text"><i class="fas fa-balance-scale-right"></i></span>
            <input type="text" id="nutrientImbalance" name="nutrientImbalance" class="form-control" 
                   placeholder="e.g., 1.5 (N:P ratio)" />
          </div>
          <div class="form-text">e.g., N:P ratio or similar calculated index.</div>
        </div>

        <div class="col-12">
          <label for="soilStress" class="form-label">Soil Stress Condition <span class="text-muted">(Optional)</span></label>
          <select id="soilStress" name="soilStress" class="form-select">
            <option value="">-- Select Soil Stress (Optional) --</option>
            <option value="Salinity">Salinity (High Salt)</option>
            <option value="Alkalinity">Alkalinity (High pH)</option>
            <option value="Waterlogging">Waterlogging (Saturated)</option>
            <option value="Drought">Drought (Severe Dryness)</option>
            <option value="None">None / Low Stress</option>
          </select>
        </div>


        <div class="col-12 mt-4">
          <button type="submit" class="btn btn-success btn-lg w-100">
            <i class="fas fa-microscope me-2"></i> Analyze Soil & Get Crop Advice
          </button>
        </div>

      </form>
    </div>
  </div>
</div>

<script>
  const API_KEY = "109dbe4aee08a2349bbf1fbd7eb69628"; // OpenWeather API key
  const citySelect = document.getElementById("city");

  const ndviInput = document.getElementById("ndvi");
  const avgTempInput = document.getElementById("avgTemp");
  const rainfallInput = document.getElementById("rainfall");
  const windSpeedInput = document.getElementById("windSpeed");
  const cloudCoverInput = document.getElementById("cloudCover");
  const sunshineInput = document.getElementById("sunshine");
  const organicCarbonInput = document.getElementById("organicCarbon");

  // üß≠ Average annual rainfall dataset (in mm)
  const avgRainfallData = {
    Mumbai: 2400,
    Pune: 720,
    Nagpur: 1100,
    Nashik: 900,
    Aurangabad: 700,
    Solapur: 670,
    Kolhapur: 2000,
    Amravati: 960,
    Latur: 800,
    Akola: 950,
    Chandrapur: 1200,
    Sangli: 600,
    Ahmednagar: 550,
    Thane: 3000,
    Satara: 1100
  };

  // Fetch data when city changes
  citySelect.addEventListener("change", async () => {
    const city = citySelect.value.trim();
    if (!city) return;

    try {
      // üå¶ 1Ô∏è‚É£ Fetch data from OpenWeather API
      const response = await fetch(
        `https://api.openweathermap.org/data/2.5/weather?q=${city},IN&appid=${API_KEY}&units=metric`
      );
      const data = await response.json();

      if (data && data.main) {
        const temp = data.main.temp || 0;
        const wind = data.wind?.speed || 0;
        const clouds = data.clouds?.all || 0;

        // üå° Fill basic weather info
        avgTempInput.value = temp.toFixed(1);
        windSpeedInput.value = wind + " m/s";
        cloudCoverInput.value = clouds + " %";

        // ‚òÄÔ∏è Estimate sunshine hours
        const sunshineHours = (12 * (100 - clouds)) / 100;
        sunshineInput.value = sunshineHours.toFixed(1);

        // üåß Fill average rainfall from dataset
        const avgRain = avgRainfallData[city] || 800; // fallback default
        rainfallInput.value = avgRain + " mm";

        // üåç NDVI (placeholder or AI integration later)
        const ndviValue = (Math.random() * 0.8 + 0.2).toFixed(2);
        ndviInput.value = ndviValue;

        // üß™ Estimate organic carbon based on NDVI
        const organicCarbon = (0.2 + ndviValue * 0.5).toFixed(2);
        organicCarbonInput.value = organicCarbon;
      } else {
        avgTempInput.value = windSpeedInput.value =
        cloudCoverInput.value = sunshineInput.value =
        rainfallInput.value = ndviInput.value = organicCarbonInput.value = "N/A";
      }
    } catch (error) {
      console.error("Error fetching weather:", error);
      avgTempInput.value = windSpeedInput.value =
      cloudCoverInput.value = sunshineInput.value =
      rainfallInput.value = ndviInput.value = organicCarbonInput.value = "N/A";
    }
  });
</script>


</body>
</html>
